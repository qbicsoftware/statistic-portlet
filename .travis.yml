# Build script for Travis CI
#

# use fast-boot container-based hosts
sudo: false 
dist: trusty

# no need to check for oracle's java
language: java
jdk: openjdk8

# speed up builds by caching maven local repository
cache:
  directories:
  - "$HOME/.m2/repository"

# as agreed in our SOP
branches:
  only:
  - master
  - development

# added to make logs look cleaner, crisper, certified fresh
before_install: unset _JAVA_OPTIONS 

# speed up builds by telling Travis that we don't need any special "installation"
install: true

# check if we need to add a license file for Vaadin charts
before_script: if [ "$VAADIN_CHARTS_LICENSE_CODE" != "" ]; then
                  echo "$VAADIN_CHARTS_LICENSE_CODE" > ~/.vaadin.charts.developer.license;
               fi;

# as agreed in our SOP, build everything (don't deploy, just try to 'mvn install' locally, which covers all phases)
script: mvn --quiet --activate-profiles !development-build,!release-build --settings .travis.settings.xml clean cobertura:cobertura install
# upload code coverage report, generate maven site (javadocs, documentation, static code analysis, etc.)
after_success: 
- bash <(curl -s https://codecov.io/bash)
- mvn --quiet --activate-profiles !development-build,!release-build --settings .travis.settings.xml site

# upload to maven
deploy:
  # as agreed in our SOP, builds on development branch will deploy to our maven repository after validating
  # the artifact has a proper SNAPSHOT version
  # artifact will be installed in our testing instance if it is a .war file
- skip_cleanup: true
  provider: script
  script: mvn --quiet --activate-profiles development-build,!release-build --settings .travis.settings.xml deploy
  on:
    branch: development
    condition: '"$TRAVIS_EVENT_TYPE" = "push"'
  # as agreed in our SOP, tagging a commit on the master branch will upload to our maven repository
  # after validating the artifact has a proper release version
  # artifact will be installed in our testing instance if it is a .war file
- skip_cleanup: true
  provider: script
  script: mvn --quiet --activate-profiles !development-build,release-build --settings .travis.settings.xml deploy
  on:
    branch: master
    condition: '"$TRAVIS_EVENT_TYPE" = "push"'

# change according to your needs, but we recommend to deactivate email notifications
# for now, we configured Travis to send a notification to the #travis-ci channel 
notifications:
  email:
    on_success: never
    on_failure: never
  slack: 
    on_success: never
    on_failure: always
    # edit the following section if you want to get slack notifications
    rooms:
      - secure: "***"

#
# credentials
env:
  global:
    - secure: "mjHeDY0RRist43VkYwD7r5TY6DxKVI1VmMTBv8tHzCJ0p2v3jklZJYc/A1yos8R7oTWa5S5oK09enOoMOviQcU+t4XlMdKFEwpwviIB8a2piOzYC1c8b/n+nwuvqYayn/mposHEyd2Jq+X91TAN9c5lo0TAGGwglna3ZwhpUXBAmglBxGJQgV3czeo5Vi33f+7gMdIPGkQ6vuh7qmB0xyVuKIoo76WrdG1ATwoef2FDPBjadBuc63WuXqBOAFatzTsls5NFRFyLfrI1dCFZ/uxoHodtMSwPK6OqFJMpMXJuTGYGqyKhhjjvPeiPrcL79ZD3rgFeAb3GOZtRTUtbd1Qbe+Xv7V7KbHfs2pbiCNkM+ruFEV7kdJKPdVrBaNCzy1+oajyvjs2zh5+WOW8EDtUq9hmYNHMRWsNxpdmhMm7q0wevxUkPuVb4fb78nGn0sIOxNZGgSP1IsttvAHXE34LdeWbhNlL8keKwCtsAHYeqUtwqR6Y+r18k9xRhWU+LuL2cdpnP2a8CS7+9gzbqYysv77QlBwPL56+HWI90ZarT2Ja8ZQZ0IuzfexztugZdK2BPMy03BcK1phqL1u6mAQSOnuURvaC88lhkzXzWs1zgEMdg3+AuJKnUBVF1sJXI68j8bHCC+jy9WpdDRKoSMFYut2P6FeKVsS0/qmjBLK2Y="
    - secure: "F+SjLIHniTRfisnrjeNB1HLMbK116IqfhJBkr2xmjZmL6A1vqhDJA1IdQ1w3P2E8wI0dC5aGyDdNbTq5IPTknozFm8m1vyJA9dE4xjw64RTGhkHG2DZYVOKpX0A1PX8nyVCcY4ROC2svlVtNe9iRCI8r3zqRFLLyCQVtXO58HOUHZFMTkqjdhZfxFm/fM+SU2b2Ykuwq2RtMD2BpDiSJ1Qoqb81MTsFSYGd+9UwgxbsprSFymT8Hor/SHNhBwVy8aJ4ssDkDXAKVE4aU4FbVbNTQ/DFdxD7MTWOQ6fRqHHzZ7bZ46SnIcJfqn5QeW7Qei3TdqScV0/YCve5gNhLJJApEG51gL+ywraSEsfcw4h19Z4tplEYKGVEo6TEiPDl/c6xRnZ6slATrU/bQy5OFSHEvGVb0kKDG+/XvdERO2gx1dYiRBWY2pDniUdoK4mPYv+jtemBhUFUoKGvkFk1NLgGpZKjGi2atc7P3Q5EsMVAhTvnLOTwHBeJkXaMDo1LhQ/XIh/WqLrLnDIHZNy9KIZcXrSM9CjwIL1Ig1toPXvPceiQlzFZBnFpR8fP5BIsty2wdpVVik22H8Ky504V9EIh6USORTQKingxR9qzF83tQ5cEo4XRGdCwEoodzlzm0WeBiq8NFeeuwk0jMp0GqR4IpcgRx1IjOtERLyea3ajU="
    - secure: "eGwRAtu2xkpGeaQoWlwHomehCBQhDeIo2oRxBkl8HphcFLLBpEvp5D1mqtyEC9U6tzzwNkjwX6rw3su4eaDHP5jSGpuMY1YEcYZLK5n3fbHArY/gSWi+Aq3cubMuLdjOBsd7bU/Q7n4hOud23kRIk0gVN7ykZzp/s6ZPLJ6UjQSK9YQhyq7RkCK+2QLMK4tcubmoqOqbXahPuZgf3S040Zr9XHbDkf+sls1F1dBwFtEzETBK5wqJX/7em0zFQU+Ih+JyubrXW6KX5DykHskw5gaMUtZZDo6ft4DjNgU2c5biX+JYODJIWJqHJN+kjgfc2tPbncmxNWD21NmzVW2HCsUyi1GNbt1vdufvZ6Kjci1DG+zI/HYn4wzPYxFNt8PVhZK2Dn6jqr+uESjxM2y/2MKZeRd9aZc4/Qlr01u4UPV15hYmtvqpzF0qaXG9i3vEVyqyhx1Rw9y75NQ8O/zNUz9LPXu1k5WaGB+Q/8ZqvI+nuIIx4da9jrl7eoV2MpLlJAe10K6lznqwpchPKApE8ML7+sJ2/koPgWjw3kRJd3c5jHanqwryGMcdn0Ksmrvu3zcsbJewPRwC20dgyL9Goey9dLZNdxj+m0aQL2H11pp6tz2KAMf+QjPMpljPFFCkiMobgiqjk7hVHgf3wDmCzXzhXQtH80jjwPQctXs3RLc="
